import{G as k,d as j,r as p,c as W,B as X,e as c,o as Y,f as Z,g as l,w as a,h as i,z as v,i as f,x as P,H as h,p as ee,j as le,k as ae,_ as oe}from"./index-iq3_YIvd.js";const te=(r,s,g)=>k.get(`/admin/acl/role/${r}/${s}/?roleName=${g}`),ne=r=>r.id?k.put("/admin/acl/role/update",r):k.post("/admin/acl/role/save",r),re=r=>k.get("/admin/acl/permission/toAssign/"+r),se=(r,s)=>k.post(`/admin/acl/permission/doAssign/?roleId=${r}&permissionId=${s}`),de=r=>k.delete("/admin/acl/role/romove/"+r),ie=r=>(ee("data-v-ba6c65a3"),r=r(),le(),r),ue=ie(()=>ae("h4",null,"分配权限",-1)),ce=j({name:"Role"}),pe=j({...ce,setup(r){let s=p(1),g=p(10),I=p(0),V=p([]),y=p(""),m=p(!1),_=p(!1),u=W({roleName:""}),x=p(),N=p();const B={children:"children",label:"name"};let S=p([]),$=p([]);const E={roleName:[{required:!0,trigger:"blur",validator:(n,e,t)=>{e.trim().length>=2?t():t(new Error("密码长度至少2位"))}}]},w=async(n=1)=>{s.value=n,console.log(s.value,g.value,y.value);const e=await te(s.value,g.value,y.value);if(e.code===200){const t=e.data;I.value=t.total,V.value=t.records}},L=()=>{Object.assign(u,{roleName:"",id:""}),m.value=!0,P(()=>{N.value.clearValidate("roleName")})},T=n=>{P(()=>{N.value.clearValidate("roleName")}),Object.assign(u,n),m.value=!0},M=async()=>{await N.value.validate();const n=await ne(u);console.log(n),n.code===200?(h({type:"success",message:u.id?"更新成功":"添加成功"}),m.value=!1,w(u.id?s.value:1)):h({type:"error",message:u.id?"更新失败":"添加失败"})},O=async n=>{_.value=!0;const e=await re(n.id);if(Object.assign(u,n),console.log(e),e.code===200){let t=e.data;S.value=t,z(t,$.value)}},z=(n,e)=>(n.forEach(t=>{t.select&&t.level===4&&e.push(t.id),t.children&&t.children.length>0&&z(t.children,e)}),e),D=async()=>{const{id:n}=u,e=x.value.getCheckedKeys(),t=x.value.getHalfCheckedKeys();let C=e.concat(t);const d=await se(n,C);console.log(d,"分配权限得到的结果"),d.code===200&&(h({type:"success",message:"权限分配成功"}),_.value=!1,window.location.reload())},F=async n=>{(await de(n)).code==200&&(h({type:"success",message:"删除成功"}),w(V.value.length>1?s.value:s.value-1))};return X(()=>{w()}),(n,e)=>{const t=c("el-input"),C=c("el-form-item"),d=c("el-button"),R=c("el-form"),q=c("el-card"),b=c("el-table-column"),G=c("el-popconfirm"),H=c("el-table"),K=c("el-pagination"),A=c("el-dialog"),J=c("el-tree"),Q=c("el-drawer");return Y(),Z("div",null,[l(q,null,{default:a(()=>[l(R,{inline:"",class:"form"},{default:a(()=>[l(C,{label:"职位搜索"},{default:a(()=>[l(t,{placeholder:"请输入职位进行搜索",modelValue:i(y),"onUpdate:modelValue":e[0]||(e[0]=o=>v(y)?y.value=o:y=o)},null,8,["modelValue"])]),_:1}),l(C,null,{default:a(()=>[l(d,{type:"primary",onClick:e[1]||(e[1]=o=>w())},{default:a(()=>[f("搜索")]),_:1}),l(d,null,{default:a(()=>[f("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l(q,{style:{margin:"10px 0"}},{default:a(()=>[l(d,{type:"primary",icon:"Plus",onClick:L},{default:a(()=>[f(" 添加职位 ")]),_:1}),l(H,{style:{margin:"10px 0"},border:"",data:i(V)},{default:a(()=>[l(b,{type:"index",label:"#",align:"center"}),l(b,{label:"ID",align:"center",prop:"id"}),l(b,{label:"职位名称",align:"center",prop:"roleName","show-overflow-tooltip":""}),l(b,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),l(b,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),l(b,{label:"操作",width:"360px",align:"center"},{default:a(o=>[l(d,{type:"primary",icon:"User",onClick:U=>O(o.row)},{default:a(()=>[f(" 分配权限 ")]),_:2},1032,["onClick"]),l(d,{type:"primary",icon:"Edit",onClick:U=>T(o.row)},{default:a(()=>[f(" 编辑 ")]),_:2},1032,["onClick"]),l(G,{title:`确认删除职位${o.row.roleName}吗?`,width:"240",onConfirm:U=>F(o.row.id)},{reference:a(()=>[l(d,{type:"danger",icon:"Delete"},{default:a(()=>[f("删除")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(K,{"current-page":i(s),"onUpdate:currentPage":e[2]||(e[2]=o=>v(s)?s.value=o:s=o),"page-size":i(g),"onUpdate:pageSize":e[3]||(e[3]=o=>v(g)?g.value=o:g=o),"page-sizes":[10,20,30,40],background:!0,total:i(I),layout:"prev, pager, next, jumper,->, sizes, total",onSizeChange:w,onCurrentChange:w},null,8,["current-page","page-size","total"])]),_:1}),l(A,{modelValue:i(m),"onUpdate:modelValue":e[6]||(e[6]=o=>v(m)?m.value=o:m=o),title:i(u).id?"更新职位":"添加职位"},{footer:a(()=>[l(d,{onClick:e[5]||(e[5]=o=>v(m)?m.value=!1:m=!1)},{default:a(()=>[f("取消")]),_:1}),l(d,{type:"primary",onClick:M},{default:a(()=>[f("确定")]),_:1})]),default:a(()=>[l(R,{model:i(u),rules:E,ref_key:"ruleFormRef",ref:N},{default:a(()=>[l(C,{label:"职位名称",prop:"roleName"},{default:a(()=>[l(t,{placeholder:"请输入职位名称",modelValue:i(u).roleName,"onUpdate:modelValue":e[4]||(e[4]=o=>i(u).roleName=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(Q,{modelValue:i(_),"onUpdate:modelValue":e[8]||(e[8]=o=>v(_)?_.value=o:_=o)},{header:a(()=>[ue]),default:a(()=>[l(J,{data:i(S),"show-checkbox":"","node-key":"id","default-checked-keys":i($),props:B,"default-expand-all":"",ref_key:"tree",ref:x},null,8,["data","default-checked-keys"])]),footer:a(()=>[l(d,{onClick:e[7]||(e[7]=o=>v(_)?_.value=!1:_=!1)},{default:a(()=>[f("取消")]),_:1}),l(d,{type:"primary",onClick:D},{default:a(()=>[f("确定")]),_:1})]),_:1},8,["modelValue"])])}}}),_e=oe(pe,[["__scopeId","data-v-ba6c65a3"]]);export{_e as default};
