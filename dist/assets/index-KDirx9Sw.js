import{G as $,d as H,r as f,c as ee,e as s,o as v,f as P,g as e,w as t,h as u,F as E,l as M,m as D,k as Q,i as B,N as re,H as R,R as de,z as X,S as ie,t as ce,M as pe,v as me,C as _e,K as J,Q as W}from"./index-iq3_YIvd.js";const ge=(y,b,V)=>$.get(`/admin/product/${y}/${b}?category3Id=${V}`),Y=()=>$.get("/admin/product/baseTrademark/getTrademarkList"),le=y=>$.get("/admin/product/spuImageList/"+y),te=y=>$.get("/admin/product/spuSaleAttrList/"+y),Z=()=>$.get("/admin/product/baseSaleAttrList"),fe=y=>y.id?$.post("/admin/product/updateSpuInfo",y):$.post("/admin/product/saveSpuInfo",y),ve=y=>$.post("/admin/product/saveSkuInfo",y),ye=y=>$.get("/admin/product/findBySpuId/"+y),Se=y=>$.delete("/admin/product/deleteSpu/"+y),be=["src"],Ve=H({name:"skuForm"}),ke=H({...Ve,emits:["changeSence"],setup(y,{expose:b,emit:V}){const L=V;let C=f([]),k=f([]),w=f([]),d=ee({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:"",saleidValueid:"",attrKeyValueId:""}),p=f("");const I=()=>{L("changeSence",{sence:0})},z=async(U,r,i)=>{console.log(U,r,i);const g=await re(U,r,i.category3Id);console.log(g,"获取平台属性"),C.value=g.data;let h=await te(i.id);console.log(h,"已有销售属性"),k.value=h.data;let c=await le(i.id);console.log(c,"获取所有的图片数据"),w.value=c.data,d.category3Id=i.category3Id,d.spuId=i.id,d.tmId=i.tmId},x=U=>{console.log(U.imgUrl),d.skuDefaultImg=U.imgUrl,w.value.forEach(r=>{p.value.toggleRowSelection(r,!1)}),p.value.toggleRowSelection(U,!0)},F=async()=>{d.skuAttrValueList=C.value.reduce((r,i)=>{if(i.attrKeyValueId){let[g,h]=i.attrKeyValueId.split(":");r.push({attrId:g,valueId:h})}return r},[]),d.skuSaleAttrValueList=k.value.reduce((r,i)=>{if(i.saleidValueid){let[g,h]=i.saleidValueid.split(":");r.push({saleAttrId:g,saleAttrValueId:h})}return r},[]);const U=await ve(d);console.log("sku保存",U),U.code===200?(R({type:"success",message:"添加成功"}),L("changeSence",{sence:0})):R({type:"error",message:"添加失败"})};return b({init:z}),(U,r)=>{const i=s("el-input"),g=s("el-form-item"),h=s("el-option"),c=s("el-select"),m=s("el-form"),q=s("el-table-column"),N=s("el-button"),A=s("el-table"),o=s("el-form-column");return v(),P("div",null,[e(m,{"label-width":"140px"},{default:t(()=>[e(g,{label:"SKU名称"},{default:t(()=>[e(i,{placeholder:"SKU名称",modelValue:u(d).skuName,"onUpdate:modelValue":r[0]||(r[0]=l=>u(d).skuName=l)},null,8,["modelValue"])]),_:1}),e(g,{label:"SKU价格（元）"},{default:t(()=>[e(i,{placeholder:"SKU价格（元）",type:"number",modelValue:u(d).price,"onUpdate:modelValue":r[1]||(r[1]=l=>u(d).price=l)},null,8,["modelValue"])]),_:1}),e(g,{label:"重量（克）"},{default:t(()=>[e(i,{placeholder:"重量（克）",type:"number",modelValue:u(d).weight,"onUpdate:modelValue":r[2]||(r[2]=l=>u(d).weight=l)},null,8,["modelValue"])]),_:1}),e(g,{label:"描述"},{default:t(()=>[e(i,{placeholder:"描述",type:"textarea",modelValue:u(d).skuDesc,"onUpdate:modelValue":r[3]||(r[3]=l=>u(d).skuDesc=l)},null,8,["modelValue"])]),_:1}),e(g,{label:"平台属性"},{default:t(()=>[e(m,{inline:"","label-width":"100px"},{default:t(()=>[(v(!0),P(E,null,M(u(C),l=>(v(),D(g,{label:l.attrName,key:l.id,style:{"margin-bottom":"5px"}},{default:t(()=>[e(c,{modelValue:l.attrKeyValueId,"onUpdate:modelValue":a=>l.attrKeyValueId=a},{default:t(()=>[(v(!0),P(E,null,M(l.attrValueList,a=>(v(),D(h,{label:a.valueName,value:l.id+":"+a.id,key:a.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(g,{label:"销售属性"},{default:t(()=>[e(m,{inline:""},{default:t(()=>[(v(!0),P(E,null,M(u(k),l=>(v(),D(g,{label:l.saleAttrName,key:l.id},{default:t(()=>[e(c,{modelValue:l.saleidValueid,"onUpdate:modelValue":a=>l.saleidValueid=a},{default:t(()=>[(v(!0),P(E,null,M(l.spuSaleAttrValueList,a=>(v(),D(h,{label:a.saleAttrValueName,value:`${a.id}`,key:a.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(g,{label:"图片名称"},{default:t(()=>[e(A,{border:"",data:u(w),ref_key:"tableRef",ref:p},{default:t(()=>[e(q,{type:"selection",align:"center",width:"100px"}),e(q,{label:"图片"},{default:t(l=>[Q("img",{src:l.row.imgUrl,alt:"",style:{width:"100px",height:"100px"}},null,8,be)]),_:1}),e(q,{label:"名称",prop:"imgName"}),e(q,{label:"操作"},{default:t(l=>[e(N,{type:"primary",size:"small",onClick:a=>x(l.row)},{default:t(()=>[B(" 设置默认 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(o,null,{default:t(()=>[e(N,{type:"primary",onClick:F},{default:t(()=>[B("保存")]),_:1}),e(N,{onClick:I},{default:t(()=>[B("取消")]),_:1})]),_:1})]),_:1})])}}}),we=["src"],Ue=H({name:"spuForm"}),Ae=H({...Ue,emits:["changeSence"],setup(y,{expose:b,emit:V}){let L=V,C=f([]),k=f([]),w=f([]),d=f([]),p=ee({category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrValueList:[]}),I=f("");const z=()=>{L("changeSence",{sence:0})},x=f(""),F=f(!1),U=(o,l)=>{console.log(o,l)},r=o=>{x.value=o.url,F.value=!0},i=async o=>{p.value=o;let l=await Y();console.log(l,"获取的结果的result"),l.code===200&&(C.value=l.data);let a=await le(o.id);a.code===200&&(k.value=a.data.map(_=>({name:_.imgName,url:_.imgUrl})));let S=await te(o.id);console.log(S,"获取的结果的result2"),S.code===200&&(w.value=S.data);let K=await Z();console.log(K,"获取的结果的result3"),K.code===200&&(d.value=K.data)},g=async o=>{Object.assign(p.value,{category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrValueList:[]}),k.value=[],w.value=[],I.value="",p.value.category3Id=o;let l=await Y();console.log(l,"获取的结果的result"),l.code===200&&(C.value=l.data);let a=await Z();console.log(a,"获取的结果的result3"),a.code===200&&(d.value=a.data)},h=o=>o.type==="image/png"||o.type==="image/jpeg"||o.type==="image/gif"?o.size/1024/1024<3?!0:(R({type:"error",message:"文件大小不能超过3MB"}),!1):(R({type:"error",message:"上传图片的格式必须是png|jpg|gif"}),!1),c=()=>{const o=I.value.split(":"),[l,a]=o;let S={baseSaleAttrId:l,saleAttrName:a,spuSaleAttrValueList:[]};w.value.push(S),I.value=""},m=o=>{o.flag=!0,o.saleAttrValue=""},q=o=>{console.log(o);const{baseSaleAttrId:l,saleAttrValue:a}=o;let S={baseSaleAttrId:l,saleAttrValueName:a};if(!(a!=null&&a.trim()))return R({type:"error",message:"属性值不能为空"}),!1;if(o.spuSaleAttrValueList.find(_=>_.saleAttrValueName===a))return R({type:"error",message:"属性值不能重复"}),!1;o.spuSaleAttrValueList.push(S),o.flag=!1},N=async()=>{p.value.spuImageList=k.value.map(l=>({imgName:l.name,imgUrl:l.response?l.response.data:l.url})),p.value.spuSaleAttrList=w.value;const o=await fe(p.value);console.log("保存表单的结果",o),o.code===200&&(R({type:"success",message:p.value.id?"更新成功":"修改成功"}),L("changeSence",{sence:0,operation:p.value.id?"update":"add"}))};let A=de(()=>d.value.filter(l=>w.value.every(a=>l.name!==a.saleAttrName)));return b({initHasSpuData:i,initAddSpu:g}),(o,l)=>{const a=s("el-input"),S=s("el-form-item"),K=s("el-option"),_=s("el-select"),T=s("el-icon"),ae=s("el-upload"),oe=s("el-dialog"),j=s("el-button"),O=s("el-table-column"),ne=s("el-tag"),ue=s("el-table"),se=s("el-form");return v(),P("div",null,[e(se,{"label-width":"120"},{default:t(()=>[e(S,{label:"SPU名称"},{default:t(()=>[e(a,{placeholder:"请输入SPU名称",modelValue:u(p).spuName,"onUpdate:modelValue":l[0]||(l[0]=n=>u(p).spuName=n)},null,8,["modelValue"])]),_:1}),e(S,{label:"SPU名称"},{default:t(()=>[e(_,{modelValue:u(p).tmId,"onUpdate:modelValue":l[1]||(l[1]=n=>u(p).tmId=n)},{default:t(()=>[(v(!0),P(E,null,M(u(C),n=>(v(),D(K,{label:n.tmName,value:n.id,key:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(S,{label:"SPU描述"},{default:t(()=>[e(a,{placeholder:"请输入SPU名称",type:"textarea",modelValue:u(p).description,"onUpdate:modelValue":l[2]||(l[2]=n=>u(p).description=n)},null,8,["modelValue"])]),_:1}),e(S,{label:"SPU图片"},{default:t(()=>[e(ae,{"file-list":u(k),"onUpdate:fileList":l[3]||(l[3]=n=>X(k)?k.value=n:k=n),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":r,"on-remove":U,"before-upload":h},{default:t(()=>[e(T,null,{default:t(()=>[e(u(ie))]),_:1})]),_:1},8,["file-list"]),e(oe,{modelValue:F.value,"onUpdate:modelValue":l[4]||(l[4]=n=>F.value=n)},{default:t(()=>[Q("img",{"w-full":"",src:x.value,alt:"Preview Image"},null,8,we)]),_:1},8,["modelValue"])]),_:1}),e(S,{label:"SPU销售属性"},{default:t(()=>[e(_,{modelValue:u(I),"onUpdate:modelValue":l[5]||(l[5]=n=>X(I)?I.value=n:I=n),placeholder:u(A).length?`还未选择${u(A).length}个`:"无"},{default:t(()=>[(v(!0),P(E,null,M(u(A),n=>(v(),D(K,{label:n.name,value:n.id+":"+n.name,key:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),e(j,{icon:"Plus",type:"primary",style:{margin:"0 10px"},disabled:!u(I),onClick:c},{default:t(()=>[B(" 添加属性 ")]),_:1},8,["disabled"]),e(ue,{border:"",style:{margin:"20px 0"},data:u(w)},{default:t(()=>[e(O,{label:"序号",type:"index",align:"center",width:"80"}),e(O,{label:"销售属性名字",width:"120",prop:"saleAttrName"}),e(O,{label:"销售属性值"},{default:t(n=>[(v(!0),P(E,null,M(n.row.spuSaleAttrValueList,G=>(v(),D(ne,{key:G.id,style:{margin:"0 10px"},closable:"",onClose:Le=>n.row.spuSaleAttrValueList.splice(n.$index,1)},{default:t(()=>[B(ce(G.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),n.row.flag?(v(),D(a,{key:0,placeholder:"请输入属性值",size:"small",style:{width:"100px"},modelValue:n.row.saleAttrValue,"onUpdate:modelValue":G=>n.row.saleAttrValue=G,onBlur:G=>q(n.row)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(v(),D(j,{key:1,type:"primary",icon:"Plus",size:"small",onClick:G=>m(n.row)},null,8,["onClick"]))]),_:1}),e(O,{label:"操作",width:"120"},{default:t(n=>[e(j,{type:"danger",icon:"Delete",size:"small",onClick:G=>u(w).splice(n.$index,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(S,null,{default:t(()=>[e(j,{type:"primary",onClick:N},{default:t(()=>[B("保存")]),_:1}),e(j,{onClick:z},{default:t(()=>[B("取消")]),_:1})]),_:1})]),_:1})])}}}),Ie=["src"],he=H({name:"Spu"}),xe=H({...he,setup(y){const b=pe(),V=f(0),L=f(1),C=f(3);let k=f([]),w=f(0),d=f(),p=f(),I=f([]),z=f(!1);const x=async(c=1)=>{L.value=c;const m=await ge(L.value,C.value,b.c3Id);m.code===200&&(k.value=m.data.records,w.value=m.data.total)},F=()=>{V.value=1,d.value.initAddSpu(b.c3Id)},U=c=>{V.value=1,d.value.initHasSpuData(c)},r=c=>{V.value=c.sence,c.operation==="update"&&x(L.value),c.operation==="add"&&x()},i=c=>{V.value=2,p.value.init(b.c1Id,b.c2Id,c)},g=async({id:c})=>{const m=await ye(c);console.log(m,"获取skuList的结果"),m.code===200&&(I.value=m.data,z.value=!0)},h=async({id:c})=>{(await Se(c)).code===200?(R({type:"success",message:"删除成功"}),x()):R({type:"error",message:"删除失败"})};return me(()=>b.c3Id,()=>{if(!b.c3Id)return!1;x()}),_e(()=>{b.$reset()}),(c,m)=>{const q=s("Category"),N=s("el-button"),A=s("el-table-column"),o=s("el-popconfirm"),l=s("el-table"),a=s("el-pagination"),S=s("el-dialog"),K=s("el-card");return v(),P("div",null,[e(q,{sence:V.value},null,8,["sence"]),e(K,{style:{margin:"20px 0"}},{default:t(()=>[J(Q("div",null,[e(N,{type:"primary",icon:"Plus",style:{margin:"20px 0"},disabled:!u(b).c3Id,onClick:F},{default:t(()=>[B(" 添加SPU ")]),_:1},8,["disabled"]),e(l,{style:{margin:"20px 0"},border:"",data:u(k)},{default:t(()=>[e(A,{label:"序号",type:"index",align:"center",width:"80"}),e(A,{label:"SPU名称",prop:"spuName"}),e(A,{label:"SPU描述",prop:"description","show-overflow-tooltip":""}),e(A,{label:"SPU操作"},{default:t(_=>[e(N,{type:"primary",size:"small",icon:"Plus",title:"添加SKU",onClick:T=>i(_.row)},null,8,["onClick"]),e(N,{type:"primary",size:"small",icon:"Edit",title:"修改SPU",onClick:T=>U(_.row)},null,8,["onClick"]),e(N,{type:"primary",size:"small",icon:"View",title:"查看SKU列表",onClick:T=>g(_.row)},null,8,["onClick"]),e(o,{title:"确定删除吗?",width:"300px",onConfirm:T=>h(_.row)},{reference:t(()=>[e(N,{type:"danger",size:"small",icon:"Delete",title:"删除SPU"})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),e(a,{"current-page":L.value,"onUpdate:currentPage":m[0]||(m[0]=_=>L.value=_),"page-size":C.value,"onUpdate:pageSize":m[1]||(m[1]=_=>C.value=_),"page-sizes":[3,5,7,9],background:!0,layout:"prev, pager, next, jumper,->, sizes, total",total:u(w),onSizeChange:x,onCurrentChange:x},null,8,["current-page","page-size","total"])],512),[[W,V.value===0]]),J(e(Ae,{ref_key:"spuFormRef",ref:d,onChangeSence:r},null,512),[[W,V.value===1]]),J(e(ke,{onChangeSence:r,ref_key:"skuFormRef",ref:p},null,512),[[W,V.value===2]]),e(S,{title:"SKU列表",modelValue:u(z),"onUpdate:modelValue":m[2]||(m[2]=_=>X(z)?z.value=_:z=_)},{default:t(()=>[e(l,{border:"",data:u(I)},{default:t(()=>[e(A,{label:"SKU名字",prop:"skuName",width:"500px"}),e(A,{label:"SKU价格",prop:"price"}),e(A,{label:"SKU重量",prop:"weight"}),e(A,{label:"SKU图片"},{default:t(_=>[Q("img",{src:_.row.skuDefaultImg,alt:"",style:{width:"100px",height:"100px"}},null,8,Ie)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})])}}});export{xe as default};
