import{u as de}from"./setting-wuIpdkHr.js";import{G as h,d as F,r as u,c as ue,B as ie,e as m,o as $,f as O,g as l,w as t,h as n,z as b,i as p,k as G,t as D,m as P,q as pe,F as me,l as ce,x as fe,H as w,p as ge,j as ve,_ as _e}from"./index-iq3_YIvd.js";const be=(r,i,y)=>h.get(`/admin/acl/user/${r}/${i}/?username=${y}`),we=r=>r.id?h.put("/admin/acl/user/update",r):h.post("/admin/acl/user/save",r),ye=r=>h.get(`/admin/acl/user/toAssign/${r}`),Ve=r=>h.post("/admin/acl/user/doAssignRole",r),he=r=>h.delete(`/admin/acl/user/remove/${r}`),Ce=r=>h.delete("/admin/acl/user/batchRemove",{data:r}),ke=r=>(ge("data-v-42a3b592"),r=r(),ve(),r),Ue=ke(()=>G("h4",null,"分配角色",-1)),xe=F({name:"User"}),Re=F({...xe,setup(r){let i=u(1),y=u(5),N=u(0),R=u([]),f=u(!1),g=u(!1),j=u("添加用户"),d=ue({username:"",password:"",name:""});const k=u([]),U=u([]),S=u("");let q=u([]),x=u(!1),I=u(!0),C=u(""),L=de();const M={username:[{required:!0,trigger:"blur",validator:(o,e,s)=>{e.trim().length>=5?s():s(new Error("账号长度至少5位"))}}],password:[{required:!0,trigger:"blur",validator:(o,e,s)=>{e.length>=6?s():s(new Error("密码长度至少6位"))}}]},_=async(o=1)=>{i.value=o;const e=await be(i.value,y.value,C.value);if(e.code===200){const s=e.data;N.value=s.total,R.value=s.records}},H=()=>{fe(()=>{S.value.clearValidate("username"),S.value.clearValidate("password")}),Object.assign(d,{id:""}),f.value=!0},J=async o=>{j.value="修改用户",f.value=!0,Object.assign(d,o)},K=async()=>{await S.value.validate(),(await we(d)).code===200?(f.value=!1,w({type:"success",message:`${d.id?"更新":"添加成功"}`}),window.location.reload(),_()):w({type:"error",message:`${d.id?"更新":"添加失败"}`})},Q=async o=>{Object.assign(d,o),g.value=!0;const e=await ye(o.id);if(console.log(e,"加载角色的结果"),e.code===200){const s=e.data;k.value=s.allRolesList,U.value=s.assignRoles}},W=o=>{U.value=o?k.value:[],I.value=!1},X=o=>{const e=o.length;x.value=e===k.value,I.value=e>0&&e<k.value.length},Y=async()=>{let o={userId:d.id,roleIdList:U.value.map(s=>s.id)};(await Ve(o)).code===200?(w({type:"success",message:"分配成功"}),g.value=!1,_(i.value)):w({type:"error",message:"分配失败"})},Z=async o=>{(await he(o)).code===200?(w({type:"success",message:"删除成功"}),_(R.value.length>1?i.value:i.value-1)):w({type:"error",message:"删除失败"})},ee=o=>{console.log(o),q.value=o.map(e=>e.id)},le=async()=>{let o=q.value;(await Ce(o)).code===200?(w({type:"success",message:"删除成功"}),_(R.value.length>1?i.value:i.value-1)):w({type:"error",message:"删除失败"})},ae=()=>{_(),C.value=""},te=()=>{L.refresh=!L.refresh};return ie(()=>{_()}),(o,e)=>{const s=m("el-input"),V=m("el-form-item"),c=m("el-button"),z=m("el-form"),A=m("el-card"),v=m("el-table-column"),oe=m("el-popconfirm"),ne=m("el-table"),se=m("el-pagination"),B=m("el-drawer"),E=m("el-checkbox"),re=m("el-checkbox-group");return $(),O("div",null,[l(A,{style:{height:"80px","margin-bottom":"20px"}},{default:t(()=>[l(z,{inline:"",ref:"formRef","label-width":"100px",class:"form"},{default:t(()=>[l(V,{label:"用户名"},{default:t(()=>[l(s,{type:"text",autocomplete:"off",modelValue:n(C),"onUpdate:modelValue":e[0]||(e[0]=a=>b(C)?C.value=a:C=a)},null,8,["modelValue"])]),_:1}),l(V,null,{default:t(()=>[l(c,{type:"primary",onClick:ae},{default:t(()=>[p("搜索")]),_:1}),l(c,{onClick:te},{default:t(()=>[p("重置")]),_:1})]),_:1})]),_:1},512)]),_:1}),l(A,null,{default:t(()=>[l(c,{type:"primary",onClick:H},{default:t(()=>[p("添加用户")]),_:1}),l(c,{type:"danger",disabled:n(q).length===0,onClick:le},{default:t(()=>[p(" 批量删除 ")]),_:1},8,["disabled"]),l(ne,{border:"",style:{margin:"10px 0"},data:n(R),onSelectionChange:ee},{default:t(()=>[l(v,{type:"selection",align:"center"}),l(v,{label:"#",type:"index",align:"center"}),l(v,{label:"ID",prop:"id",align:"center"}),l(v,{label:"用户名",align:"center",prop:"username","show-overflow-tooltip":""}),l(v,{label:"用户昵称",align:"center","show-overflow-tooltip":"",prop:"name"}),l(v,{label:"用户角色",align:"center",prop:"roleName",width:"180px","show-overflow-tooltip":""}),l(v,{label:"创建时间",align:"center",prop:"createTime",width:"180px"}),l(v,{label:"更新时间",align:"center",prop:"updateTime",width:"180px"}),l(v,{label:"操作",width:"340",align:"center"},{default:t(a=>[l(c,{type:"primary",icon:"User",onClick:T=>Q(a.row)},{default:t(()=>[p(" 分配角色 ")]),_:2},1032,["onClick"]),l(c,{type:"primary",icon:"Edit",onClick:T=>J(a.row)},{default:t(()=>[p(" 编辑 ")]),_:2},1032,["onClick"]),l(oe,{title:`确认删除用户${a.row.name}吗?`,width:"240",onConfirm:T=>Z(a.row.id)},{reference:t(()=>[l(c,{type:"danger",icon:"Delete"},{default:t(()=>[p("删除")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(se,{"current-page":n(i),"onUpdate:currentPage":e[1]||(e[1]=a=>b(i)?i.value=a:i=a),"page-size":n(y),"onUpdate:pageSize":e[2]||(e[2]=a=>b(y)?y.value=a:y=a),"page-sizes":[5,7,9,11],background:!0,total:n(N),layout:"prev, pager, next, jumper,->, sizes, total",onSizeChange:e[3]||(e[3]=a=>_(1)),onCurrentChange:_},null,8,["current-page","page-size","total"])]),_:1}),l(B,{modelValue:n(f),"onUpdate:modelValue":e[8]||(e[8]=a=>b(f)?f.value=a:f=a)},{header:t(()=>[G("h4",null,D(n(j)),1)]),default:t(()=>[l(z,{ref_key:"form",ref:S,model:n(d),rules:M,"label-width":"100px"},{default:t(()=>[l(V,{label:"用户姓名",prop:"username"},{default:t(()=>[l(s,{placeholder:"请输入用户名",modelValue:n(d).username,"onUpdate:modelValue":e[4]||(e[4]=a=>n(d).username=a)},null,8,["modelValue"])]),_:1}),l(V,{label:"用户昵称",prop:"name"},{default:t(()=>[l(s,{placeholder:"请输入用户昵称",modelValue:n(d).name,"onUpdate:modelValue":e[5]||(e[5]=a=>n(d).name=a)},null,8,["modelValue"])]),_:1}),n(d).id?pe("",!0):($(),P(V,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[l(s,{placeholder:"请输入用户密码",modelValue:n(d).password,"onUpdate:modelValue":e[6]||(e[6]=a=>n(d).password=a)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),footer:t(()=>[l(c,{onClick:e[7]||(e[7]=a=>b(f)?f.value=!1:f=!1)},{default:t(()=>[p("取消")]),_:1}),l(c,{type:"primary",onClick:K},{default:t(()=>[p("确定")]),_:1})]),_:1},8,["modelValue"]),l(B,{modelValue:n(g),"onUpdate:modelValue":e[13]||(e[13]=a=>b(g)?g.value=a:g=a)},{header:t(()=>[Ue]),default:t(()=>[l(z,{"label-width":"100px"},{default:t(()=>[l(V,{label:"用户姓名"},{default:t(()=>[l(s,{modelValue:n(d).username,"onUpdate:modelValue":e[9]||(e[9]=a=>n(d).username=a),disabled:""},null,8,["modelValue"])]),_:1}),l(V,{label:"角色列表"},{default:t(()=>[l(E,{indeterminate:n(I),modelValue:n(x),"onUpdate:modelValue":e[10]||(e[10]=a=>b(x)?x.value=a:x=a),onChange:W},{default:t(()=>[p(" 全选 ")]),_:1},8,["indeterminate","modelValue"]),l(re,{modelValue:U.value,"onUpdate:modelValue":e[11]||(e[11]=a=>U.value=a),onChange:X},{default:t(()=>[($(!0),O(me,null,ce(k.value,a=>($(),P(E,{key:a.id,label:a},{default:t(()=>[p(D(a.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),footer:t(()=>[l(c,{onClick:e[12]||(e[12]=a=>b(g)?g.value=!1:g=!1)},{default:t(()=>[p("取消")]),_:1}),l(c,{type:"primary",onClick:Y},{default:t(()=>[p("确定")]),_:1})]),_:1},8,["modelValue"])])}}}),ze=_e(Re,[["__scopeId","data-v-42a3b592"]]);export{ze as default};
